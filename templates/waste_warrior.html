{% extends 'base.html' %}
{% block title %} Waste Warrior{% endblock title %}
{% block body %}
<div class="warrior-container">
    <h2>Manage Complaints</h2>
    <div class="mb-3">
        <a href="{{ url_for('logout') }}" class="btn btn-danger">Logout</a>
    </div>
    {% for c in complaints %}
    <div class="complaint-card">
        <p><strong>ID:</strong> {{ c.id }}</p>
        <p><strong>Name:</strong> {{ c.name }}</p>
        <p><strong>Address:</strong> {{ c.address }}</p>
        <p><strong>Description:</strong> {{ c.description }}</p>
        <p><strong>Status:</strong> {{ c.status }}</p>

        <form method="POST" action="{{ url_for('update_complaint', complaint_id=c.id) }}" class="update-form">
            <select name="status" required>
                <option value="Pending" {% if c.status=='Pending' %}selected{% endif %}>Pending</option>
                <option value="In Progress" {% if c.status=='In Progress' %}selected{% endif %}>In Progress</option>
                <option value="Resolved" {% if c.status=='Resolved' %}selected{% endif %}>Resolved</option>
            </select>

            <input type="text" name="remark" placeholder="Add a remark" required>
            <button type="submit">Update</button>
        </form>
        <div class="mt-3">
            <h6>Updates:</h6>
            {% for update in c.updates %}
            <div class="card mb-2">
                <div class="card-body">
                    <p class="mb-1"><strong>{{ update.admin_user.email }}</strong> on {{
                        update.update_date.strftime('%Y-%m-%d %H:%M') }}</p>
                    <p class="mb-1">Changed status to: {{ update.status_change }}</p>
                    <p class="mb-0">Remarks: {{ update.update_text }}</p>
                </div>
            </div>
            {% else %}
            <p>No updates yet</p>
            {% endfor %}
        </div>
    </div>
    {% endfor %}
</div>

{% endblock body %}